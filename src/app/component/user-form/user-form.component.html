<form [formGroup]="dynamicForm" autocomplete="on">
  <div class="border border-1 border-white" [ngClass]="schema?.fields!.length>5? `h-100 overflow-auto resize`:``">
  <table class="h-full w-full transition-all" >
    <tr
      *ngFor="let field of schema?.fields"
      class="text-white flex flex-row justify-between rounded"
      [title]="field.name"
      >
      <td class="max-w-1/3 m-2 overflow-auto">
        <label [for]="field.name">{{ field.label }}</label>
      </td>
      <td class="flex min-w-2/3 content-center justify-center">
        <input
          *ngIf="inputTagTypes.includes(field.type)"
          [type]="field.type"
          [id]="field.name"
          [formControlName]="field.name"
          [placeholder]="field.placeholder || ''"
          [min]="field.validation?.min"
          [max]="field.validation?.max"
          [step]="field.validation?.step"
          [readonly]="field.validation?.readonly"
          class="w-full outline-1 p-2 m-1"
        />
        <a *ngIf="field.type === 'url'"
          [href]="field.validation?.pattern?
          field.validation?.pattern?.replace('{key}',dynamicForm.get(field.name)?.value.trim())
          :dynamicForm.get(field.name)?.value"
          [formControlName]="field.name" 
          [title]="field.name">
          {{field.label}}
        </a>
        <textarea
          *ngIf="field.type === 'textarea' || field.type === 'timestamp' "
          [id]="field.name"
          [formControlName]="field.name"
          [placeholder]="field.placeholder || ''"
          [readonly]="field.validation?.readonly"
          class="w-full"
        ></textarea>
        <select
          *ngIf="field.type === 'select'"
          class="w-full"
          style="background-color: #15162c;"
          [id]="field.name"
          [formControlName]="field.name"
        >
          <option *ngFor="let option of field.options" [value]="option">{{ option }}</option>
        </select>
        <div *ngIf="field.type === 'radio'" class="flex flex-wrap" [id]="field.name">
          <div *ngFor="let option of field.options;" class="flex-shrink-0 m-1" [title]="field.name+'-'+option">
            <label [for]="field.name+'-'+option">{{option}}:</label>
            <input type="radio" [id]="field.name+'-'+option" [value]="option" [name]="field.name" [formControlName]="field.name">
          </div>
        </div>
        <div *ngIf="field.type === 'checkbox'" class="flex flex-wrap" [id]="field.name">
          <div *ngFor="let option of field.options;let i = index" class="flex-shrink-0 m-1" [title]="field.name+'-'+option" [formArrayName]="field.name">
            <label [for]="field.name+'-'+option">{{option}}:</label>
            <input type="checkbox" [id]="field.name+'-'+option" [value]="option" [name]="field.name" [formControlName]="i">
          </div>
        </div>
        <div *ngIf="field.type === 'boolean'" [id]="field.name">
          YES:<input
            [formControlName]="field.name"
            type="radio"
            [name]="field.name"
            value="true"
          />
          &nbsp;
          NO:<input
            [formControlName]="field.name"
            type="radio"
            [name]="field.name"
            value="false"
          />
        </div>
        <div
          *ngIf="field.type === 'image'"
          [title]="field.label"
          class="w-2/3"
        >
          <input
            class="w-full"
            style="mix-blend-mode: difference"
            [value]="dynamicForm.get(field.name)?.value"
            type="text"
            [formControlName]="field.name"
            [placeholder]="field.placeholder"
            [readonly]="field.validation?.readonly"
          />
          <img
            [src]="dynamicForm.get(field.name)?.value"
            class="border border-1 w-full"
          />
        </div>

        <div class="overflow-hidden resize h-fit bg-white" [id]="field.name+'_container'"
          *ngIf="field.type === 'canvas' && fabricjsLoaded"
        >
          <div class="fixed bottom-0 right-20 flex flex-row flex-wrap max-w-100 z-1000" [id]="field.name+'_btn_controls_container'" style="mix-blend-mode: difference; display: none;">
            <button type="button" class="m-2 p-2 bg-gray-600 rounded" [id]="field.name+'_btn_add_textbox'" >textbox</button>
            <button type="button" class="m-2 p-2 bg-gray-600 rounded" [id]="field.name+'_btn_add_rectangle'" >rectangle</button>
            <button type="button" class="m-2 p-2 bg-gray-600 rounded" [id]="field.name+'_btn_add_triangle'" >triangle</button>
            <button type="button" class="m-2 p-2 bg-gray-600 rounded" [id]="field.name+'_btn_add_circle'" >circle</button>
            <button type="button" class="m-2 p-2 bg-gray-600 rounded" [id]="field.name+'_btn_add_line'" >line</button>
            
            <button type="button" class="m-2 p-2 bg-gray-600 rounded" [id]="field.name+'_btn_clear'" >clear</button>
            <button type="button" class="m-2 p-2 bg-gray-600 rounded" [id]="field.name+'_btn_drawmode_toggle'" >toggle drawmode</button>
          </div>
          <canvas  
                  [id]="field.name" 
                > 
          </canvas>
        </div>
       </td>
    </tr>
  </table>
  </div>
</form>
